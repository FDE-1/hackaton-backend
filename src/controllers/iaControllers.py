from flask import request
from ..services.iaService import query_ollama
from ..controllers import scrapperControllers
def generate():
    url = request.get_json()
    data, status = scrapperControllers.get_data(url["url"])
    # print(data.get_json())
    # data = "'{'author': 'Samuel90', 'content': 'La souris est légère vif et très confortable', 'date': 'Date inconnue', 'rating': 4.0, 'title': 'Très bien'}, {'author': 'Fuzzer   publié le', 'content': 'Rien à dire de plus ça marche nickel et j'adore son design simpliste mais tout en étant gamer', 'date': '08/05/2025', 'rating': 4.0, 'title': 'Parfait'}, {'author': 'Julie72   publié le', 'content': 'Mon fils est ravie? elle est jolie et fait son effet. Je recommande!', 'date': '22/03/2025', 'rating': 5.0, 'title': 'Souris gamer'}, {'author': 'Ness   publié le', 'content': 'Mon fils est satisfait de cet achat', 'date': '27/02/2025', 'rating': 4.0, 'title': 'Souris pc'}, {'author': 'piton62   publié le', 'content': 'très bonne souris pour le prix', 'date': '18/02/2025', 'rating': 5.0, 'title': 'super'}, {'author': 'jeromel71   publié le', 'content': 'Très bien, agréable à l'utilisation, et appréciable le clic silencieux de la souris.', 'date': '12/02/2025', 'rating': 5.0, 'title': 'Silencieuse'}, {'author': 'celis   publié le', 'content': 'J'ai recu un autre model de souris non conforme', 'date': '23/01/2025', 'rating': 1.0, 'title': 'MAUVAIS MODELE'}, {'author': 'Zoukor   publié le', 'content': 'Impeccable Produit Neuf arrivé très vite et bien emballé en Point relais Bonne souris performante', 'date': '04/01/2025', 'rating': 5.0, 'title': 'Top'}, {'author': 'MasterChef   publié le', 'content': 'Efficace Technologie au top\nLe + : l’ambiance des lumières leds qui changent de couleur donnent un style et est agréable en soirée Je recommande absolument', 'date': '23/12/2024', 'rating': 5.0, 'title': 'Super souris à petit prix'}, {'author': 'zeus01   publié le', 'content': 'J'ai acheté cette souris pour ma femme de polyarthrite rhumatoïde.\nElle est légère, les boutons sont très souples à appuyer.\nLes lumières led donnent un côté très moderne et bien visible dans le noir.', 'date': '06/12/2024', 'rating': 5.0, 'title': 'Très bonne souris.'}, {'author': 'titomaster   publié le', 'content': 'Encore une fois ravi des produits Logitech, des performances très correctes et un design pas mal du tout le tout pour pas cher. Je recommande pour ceux qui veulent se faire un premier set up gaming sans se ruiner.', 'date': '21/11/2024', 'rating': 5.0, 'title': 'Très bien pour debutant'}, {'author': 'Khadi   publié le', 'content': 'Elle marche très bien', 'date': '19/11/2024', 'rating': 4.0, 'title': 'Souiris'}, {'author': 'Guinet   publié le', 'content': 'agréablement surpris ? je recommande cette souris', 'date': '20/08/2024', 'rating': 5.0, 'title': 'légère'}, {'author': 'Ohio147   publié le', 'content': 'Souri ergonomique facile (plug & play) et agréable à utiliser. Un bémol : un bout de plastique semble se balader à l'intérieur. Ne compromet pas les performances mais c'est un peu étrange quand même. 5 étoiles sinon.', 'date': '15/08/2024', 'rating': 4.0, 'title': 'Souri agréable à utiliser.'}, {'author': 'dany25   publié le', 'content': 'Prise en main agréable. Fil de qualité standard, plutôt long. Cette souris et très facile à utilisée. Souris compatible avec le logiciel de Logitech pour pouvoir changer le DPI de la souris. Pour le prix c'est vraiment incroyable. Je recommande ! avec Cdiscount et son partenaire comme d'habitude parfait. livraison rapide merci', 'date': '29/03/2024', 'rating': 5.0, 'title': 'très bonne souris gamer'}, {'author': 'guypguyp44   publié le', 'content': 'son look son prix la marque', 'date': '09/03/2024', 'rating': 4.0, 'title': 'bon produit'}, {'author': 'Farid   publié le', 'content': 'Très bonne souris je recommande fortement', 'date': '13/12/2023', 'rating': 5.0, 'title': 'Bonne souris'}, {'author': 'redkilzer   publié le', 'content': 'Je recommande ce produit !', 'date': '24/09/2023', 'rating': 5.0, 'title': 'Parfait !'}, {'author': 'Nicolas   publié le', 'content': 'Trés bonne souris,ces du logitech donc trés bonne souris de plus ces filaire donc moi qui détéste le wireless ces top', 'date': '03/09/2023', 'rating': 5.0, 'title': 'Parfait'}, {'author': 'esteban   publié le', 'content': 'une souris super pour son prix pour les petit main ou grande main', 'date': '31/08/2023', 'rating': 5.0, 'title': 'Super souris'}, {'author': 'Mimie   publié le', 'content': 'Souris petite et réactive parfaite', 'date': '04/08/2023', 'rating': 5.0, 'title': 'Super'}, {'author': 'Nanass   publié le', 'content': 'bonne souris qui se marie très bien à mon clavier LG. Pour le moment rien à redire, je joue toujours aussi mal à overwatch avec ;)', 'date': '03/07/2023', 'rating': 5.0, 'title': 'bonne souris'}, {'author': 'Titib   publié le', 'content': 'Rien a dire, aucune surprise et très efficace.', 'date': '07/04/2023', 'rating': 5.0, 'title': 'Bon matériel'}, {'author': 'Florence   publié le', 'content': 'Acheté également pour mon mari', 'date': '06/11/2022', 'rating': 5.0, 'title': 'J adore'}, {'author': 'analouisa   publié le', 'content': 'Souris rapide, facile à manier et sympa avec ses changements de couleurs', 'date': '17/10/2022', 'rating': 5.0, 'title': 'Au top !'}, {'author': 'Philibert1010   publié le', 'content': 'Bon produit plus solide que la moyenne.', 'date': '19/09/2022', 'rating': 5.0, 'title': 'Produit efficace pour les gamers'}, {'author': 'sergitaire   publié le', 'content': 'depuis quelque temps j\'utilisais une souris sans fil 'noname' et mon PC plantait très souvent. depuis que j\'utilise celle-ci, plus aucun plantage et en plus elle est jolie', 'date': '15/09/2022', 'rating': 5.0, 'title': 'jolie et efficace'}, {'author': 'ousman   publié le', 'content': 'Souris parfaite pour le jeu, très réactif sans délai, je le conseille fortement ;)', 'date': '02/09/2022', 'rating': 5.0, 'title': 'Bonne souris'}, {'author': 'enaivlys56   publié le', 'content': 'En fait j'ai choisi ce modèle car je cherchais une souris pas trop chère qui soit agréable dans la manipulation et qui présente des caractéristiques techniques fiables pour un prix raisonnable. Je suis satisfaite même si je ne joue à aucun jeux.', 'date': '03/08/2022', 'rating': 5.0, 'title': 'Conforme à mes attentes'}, {'author': 'tigege24   publié le', 'content': 'Très maniable, bonne fluidité', 'date': '26/07/2022', 'rating': 5.0, 'title': 'Super'}, {'author': 'ldbs602   publié le', 'content': 'Une sourie simple et très facile à utilisée. Souris compatible avec le logiciel de Logitech pour pouvoir changer le DPI de la souris. Pour le prix c'est vraiment incroyable. Je recommande !', 'date': '15/07/2022', 'rating': 5.0, 'title': 'Souris au top !'}, {'author': 'damien18   publié le', 'content': 'Impeccable cette souris !', 'date': '01/06/2022', 'rating': 5.0, 'title': 'Extra !'}, {'author': 'Marc   publié le', 'content': 'J'avais avant une G502 mais j'avais un problème car je trouvais ma souris trop lourde (je suis gaucher et j'utilise ma souris avec la main de droite). je voulais donc une souris plus légère et aussi qualitative. Il faut pas avoir peur du fait que le dpi peut pas monter aussi haut. de toute façon vous ne le mettrez pas au max (et c'est une mauvais idée)', 'date': '09/05/2022', 'rating': 5.0, 'title': 'Super léger'}, {'author': 'Organix   publié le', 'content': 'rien a dire, fonctionnelle, jolie c'est top', 'date': '27/04/2022', 'rating': 5.0, 'title': 'RAS'}, {'author': 'Flo44710   publié le', 'content': 'Prise en main agréable. Fil de qualité standard, plutôt long.', 'date': '26/11/2021', 'rating': 5.0, 'title': 'Utilisation efficace'}, {'author': 'DG30   publié le', 'content': 'J'ai testé beaucoup de souris et c'est celle que je préfère. Elle a un super design, juste le nombres de bouton qu'il faut, on peut jouer avec et surtout un rapport qualité prix très bon. Je la recommande sans réserve.', 'date': '12/11/2021', 'rating': 5.0, 'title': 'Une souris certes simple mais super efficace'}, {'author': 'Pascal   publié le', 'content': 'Arrivé à temps (en 2 jours), sans problèmes, facile à paramétrer avec le logiciel Logitech Ghub, parfaite pour jouer sur pc quand on a un budget d'étudiant !', 'date': '13/10/2021', 'rating': 5.0, 'title': 'Excellent'}, {'author': 'Cdiscounteur   publié le', 'content': 'Mes souris précédentes avaient des parties en mousse ou en caoutchouc qui se décollaient à la longue, a force de chaleur et d'usage intensif ! Puis trop de boutons, j'avais besoin de simplicité. Celle-ci est robuste mais moins confortable que d'autres, je l'ai choisi pour son coté durable. Quant aux LED, perso j'aurais préféré une version sans et moins chere mais introuvable, du coup je l'ai juste configuré avec un léger eclairage fixe en téléchargeant le logiciel G-hub non-fourni.Globalement satisfait.?', 'date': '08/09/2021', 'rating': 4.0, 'title': 'Efficace, parait solide'}, {'author': 'orax   publié le', 'content': 'bonne souris je recommande cdl', 'date': '02/09/2021', 'rating': 5.0, 'title': 'bon produit'}, {'author': 'Crystle   publié le', 'content': 'mise en main impeccable et lumineuse', 'date': '18/07/2021', 'rating': 5.0, 'title': 'Bonne souris'}, {'author': 'Majudis   publié le', 'content': 'Je ne regrette pas l'achat de ce produit. La prise en mains est vraiment confortable. Enfin une souris qui me correspond. Très légère et glisse parfaitement bien sur un tapis de souris. Seul bémol, manque un bouton pour désactiver la lumière. On ne peut gérer la lumière que via le logiciel et à priori uniquement sous Windows.', 'date': '08/07/2021', 'rating': 4.0, 'title': 'Très confortable'}, {'author': 'moimoi   publié le', 'content': 'souris agréable à utiliser, fluide et réactive. je recommande.', 'date': '21/04/2021', 'rating': 5.0, 'title': 'agréable'}, {'author': 'Zaki   publié le', 'content': 'Commande reçue très rapidement, produit conforme, merci!', 'date': '09/04/2021', 'rating': 5.0, 'title': 'Parfait'}, {'author': 'Tommy   publié le', 'content': 'petit souris très simple mais parfait pour la bonne prise en main tel que les FPS', 'date': '09/04/2021', 'rating': 5.0, 'title': 'genial'}, {'author': 'mamiebea   publié le', 'content': 'Produit répondant à mes attentes, livraison rapide, vendeur sérieux', 'date': '04/04/2021', 'rating': 5.0, 'title': 'Très bien'}, {'author': 'Nemezis   publié le', 'content': 'J'ai acheter cette souris pour une utilisation gamins sur xbox series x et je n'ai rien a lui reprocher elle fonctionne a merveille et pour le prix je dois dire que sa aurais etais difficile de lui trouver une concurente', 'date': '23/02/2021', 'rating': 5.0, 'title': 'Simple et parfaite'}, {'author': 'Jmo1010   publié le', 'content': 'Très belle mais clic trop bruyant. Pour moi qui n'ai pas besoin des lumières et des boutons supplémentaires elle ne me convient pas, je l'ai retourné.', 'date': '18/02/2021', 'rating': 2.0, 'title': 'Jolie mais bruyante!'}, {'author': 'Maxafak   publié le', 'content': 'Trés bonne souris avec une petite touche de rgb ! Cependant attention aux grandes mains passez votre chemin !! C'est pile poil pour moi', 'date': '29/01/2021', 'rating': 5.0, 'title': 'Très bonne souris !'}, {'author': 'maxime   publié le', 'content': 'Très bon produit de qualité avec un bon rapport qualité prix', 'date': '07/11/2020', 'rating': 5.0, 'title': 'Très bon produit'}]"
    if not data.get_json():
        return {"error": "Prompt is required"}, 400
    
    try:
        result = query_ollama(data.get_json())
        # result = query_ollama(data)
        return {"response": result}
    except Exception as e:
        return {"error": f"Erreur lors de l'appel au modèle: {str(e)}"}, 500
    